@using CourseWork.Models
@{
    ViewData["Title"] = "Особистий кабінет";
    var user = ViewBag.User as ApplicationUser;
    var orders = ViewBag.Orders as List<Order>;
    var promotions = ViewBag.Promotions as List<Promotion>;
}

@section Styles {
    <link rel="stylesheet" href="~/css/profile.css" asp-append-version="true" />
}

<div class="container profile-container">
    <!-- Header Card -->
    <div class="profile-header">
        <div class="profile-avatar">
            <span class="avatar-initials">@(user?.FullName?.Substring(0, 1).ToUpper() ?? "U")</span>
        </div>
        <div class="profile-info">
            <h1>@(user?.FullName ?? "Користувач")</h1>
            <p class="profile-email">@user?.Email</p>
            <div class="profile-level">
                <span class="level-badge level-@ViewBag.UserLevel.ToLower()">@ViewBag.UserLevel</span>
                @if (ViewBag.DiscountPercent > 0)
                {
                    <span class="discount-badge">-@ViewBag.DiscountPercent% на всі замовлення</span>
                }
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
            </div>
            <div class="stat-content">
                <span class="stat-value">@ViewBag.OrderCount</span>
                <span class="stat-label">Замовлень</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon spent">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
            </div>
            <div class="stat-content">
                <span class="stat-value">@(((decimal)ViewBag.TotalSpent).ToString("N0")) ₴</span>
                <span class="stat-label">Витрачено</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon discount">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>
            </div>
            <div class="stat-content">
                <span class="stat-value">@ViewBag.DiscountPercent%</span>
                <span class="stat-label">Ваша знижка</span>
            </div>
        </div>
    </div>

    <!-- Orders Section -->
    <div class="profile-section">
        <h2 class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
            Історія замовлень
        </h2>
        
        @if (orders != null && orders.Any())
        {
            <div class="orders-list">
                @foreach (var order in orders.Take(5))
                {
                    <div class="order-card">
                        <div class="order-header">
                            <span class="order-id">#@order.Id</span>
                            <span class="order-date">@order.OrderDate.ToString("dd MMM yyyy, HH:mm")</span>
                        </div>
                        <div class="order-body">
                            <div class="order-info">
                                <span class="order-address">@order.CustomerAddress</span>
                            </div>
                            <div class="order-total">@order.TotalAmount.ToString("N0") ₴</div>
                        </div>
                        <div class="order-footer">
                            <span class="order-status status-@order.OrderStatus.ToLower()">@order.OrderStatus</span>
                        </div>
                    </div>
                }
            </div>
            
            @if (orders.Count > 5)
            {
                <a href="#" class="btn-view-all">Переглянути всі замовлення →</a>
            }
        }
        else
        {
            <div class="empty-state">
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
                <p>У вас ще немає замовлень</p>
                <a asp-controller="Home" asp-action="Index" class="btn btn-primary">Перейти до меню</a>
            </div>
        }
    </div>

    <!-- Promotions Section -->
    @if (promotions != null && promotions.Any())
    {
        <div class="profile-section">
            <h2 class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                Доступні акції
            </h2>
            <div class="promotions-grid">
                @foreach (var promo in promotions)
                {
                    <div class="promo-card">
                        <div class="promo-image">
                            <img src="@promo.ImageUrl" alt="@promo.Title">
                        </div>
                        <div class="promo-content">
                            <h3>@promo.Title</h3>
                            @if (!string.IsNullOrEmpty(promo.PromoCode))
                            {
                                <div class="promo-code">Код: <strong>@promo.PromoCode</strong></div>
                            }
                        </div>
                    </div>
                }
            </div>
        </div>
    }

    <!-- Logout Button -->
    <div class="profile-actions">
        <form asp-controller="Account" asp-action="Logout" method="post">
            <button type="submit" class="btn-logout">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                Вийти з кабінету
            </button>
        </form>
    </div>
</div>
